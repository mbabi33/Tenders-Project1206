### Алгоритм работы `parser_app_docs.py`

Этот скрипт, по сути, является "архивариусом". Его задача — извлечь из HTML-файлов всю текстовую документацию, а также собрать метаданные обо всех приложенных файлах и аккуратно сложить всё это в базу данных `docs.db`.

**Пошаговая логика:**

1.  **Инициализация:**
    *   Скрипт запускается с аргументами `-c <cpv_код>` и (опционально) `-root <путь_к_проекту>`.
    *   С помощью `config.py` определяются пути к директории с HTML (`.../app_docs/`) и к базе данных (`.../docs.db`).
    *   Вызывается функция `init_db`, которая создает в `docs.db` две таблицы, если их нет: `tnd_app_doc_sections` (для хранения текста) и `tnd_app_doc_files` (для ссылок на файлы).

2.  **Поиск файлов:**
    *   Скрипт сканирует папку `.../app_docs/` и собирает список всех файлов, имена которых заканчиваются на `_app_docs.html`.

3.  **Обработка каждого файла:**
    *   Для каждого найденного HTML-файла из его имени извлекается ID тендера (например, из `pg_NAT24_12345_app_docs.html` извлекается `12345`).
    *   Файл парсится с помощью `BeautifulSoup`.
    *   **Определение структуры:** Скрипт проверяет, какого типа документация внутри:
        *   **Тип А (Вопросы-ответы):** Если в HTML есть теги `<section class='question'>`, скрипт понимает, что это страница с вопросами и ответами.
        *   **Тип Б (Список файлов):** Если в HTML есть таблица `<table id='tender_docs'>`, это страница с перечнем документации.

4.  **Извлечение данных (в зависимости от типа):**
    *   **Если это "Вопросы-ответы":**
        *   Скрипт перебирает каждую секцию "вопрос-ответ".
        *   Извлекает текст вопроса и текст ответа, сохраняя их в таблицу `tnd_app_doc_sections`.
        *   Проверяет, есть ли в ответе прикрепленные файлы. Если есть, извлекает их названия и ссылки, сохраняя в таблицу `tnd_app_doc_files`.
    *   **Если это "Список файлов":**
        *   Скрипт перебирает каждую строку таблицы.
        *   Из строки извлекается название файла, ссылка на него и дата загрузки.
        *   Эти данные сохраняются в таблицу `tnd_app_doc_files`.

5.  **Завершение:**
    *   После обработки всех файлов скрипт закрывает соединение с базой данных и сообщает о завершении работы.

---

### Алгоритм работы `parse_app_bids.py`

Этот скрипт — "аудитор". Его задача — проанализировать страницы со ставками, определить всех участников, их ценовые предложения и рассчитать итоговый рейтинг (кто занял какое место). Результаты сохраняются в `bids.db`.

**Пошаговая логика:**

1.  **Инициализация:**
    *   Запускается аналогично предыдущему, с аргументами `-c` и `-root`.
    *   Через `config.py` находит пути к `.../app_bids/` и базе данных `.../bids.db`.
    *   **Важный момент:** Функция `init_db` **полностью удаляет и пересоздает** таблицы (`tenders`, `bidders`, `bids`) при каждом запуске. Это гарантирует, что каждый запуск начинается "с чистого листа", без старых данных.

2.  **Поиск файлов:**
    *   Сканируется папка `.../app_bids/` и ищутся все файлы, заканчивающиеся на `_app_bids.html`.

3.  **Обработка каждого файла:**
    *   Для каждого файла из его имени извлекается ID тендера (`application_id`).
    *   Этот ID немедленно записывается в таблицу `tenders`, чтобы тендер был учтен, даже если по нему не было ни одной ставки.
    *   Файл парсится с помощью `BeautifulSoup`.
    *   Скрипт находит **последнюю** таблицу с классом `ktable` на странице (именно в ней содержится нужная информация о ставках).

4.  **Извлечение данных о ставках:**
    *   Скрипт перебирает каждую строку (`<tr>`) в найденной таблице. Каждая строка — это один участник.
    *   Из ячеек строки извлекается вся информация:
        *   ID и имя участника.
        *   Сумма и дата/время **последнего** предложения.
        *   Сумма и дата/время **первого** предложения.
        *   Общее количество сделанных ставок.
    *   Вся информация по всем участникам из файла временно накапливается в списке.

5.  **Обработка и сохранение:**
    *   **Расчет рейтинга:** После того как все участники из файла собраны, список сортируется по сумме последнего предложения (от меньшего к большему). На основе этой сортировки каждому участнику присваивается итоговый ранг (1-е место, 2-е и т.д.).
    *   **Запись в БД:** Скрипт снова подключается к базе и для каждого участника:
        *   Записывает информацию о нем (ID, имя) в таблицу `bidders`.
        *   Записывает всю информацию о его ставке (ID тендера, ID участника, суммы, даты, количество и рассчитанный ранг) в главную таблицу `bids`.

6.  **Завершение:**
    *   После цикла по всем файлам работа считается выполненной.
